{% extends "helpdesk/public_base.html" %}{% load i18n humanize %}
{% load static %}
{% block helpdesk_title %}{% trans "Ticket List" %}{% endblock %}

{% block helpdesk_body %}

<div>
    {% if result %}
    <div class="container listContainer">
        <div class="cardListBtn">
            <h1 class="head">تیکت ها</h1>
            <a class="btn" href="{% url 'helpdesk:submit' %}">
                <img src="../../static/helpdesk/images/plus-circle.svg" alt="inbox" /><span class="btnText">افزودن تیکت جدید
                    </apan>
            </a>
        </div>
        <div class="card">
            <div class="cardList">
                <table  style="width: 95%;margin: 20px;">
                    <tr  style="border-bottom: 4px dashed #5BC767;">
                        <th style="padding: 40px 0px;">شماره تیکت</th>
                        <th>موضوع</th>
                        <th>تاریخ ایجاد</th>
                        <th>وضعیت تیکت</th>
                        <th>مشاهده</th>
                    </tr>
    {% for row in result reversed %}
    <tr >
        <td style="padding: 30px 0px;">{{ forloop.counter }} {{ row.from_location }} {{ row.to_location }}</td>
        <td style="width: 25%;">{{row.ticket.title}}</td>
        <td><script>function docWrite(variable) {
                document.write(`${SplitTime(variable).Days} روز و ${SplitTime(variable).Hours} ساعت پیش`);
            };
            function SplitTime(numberOfHours) {
                var Days = Math.floor(Number(numberOfHours) / 24);
                var Remainder = Number(numberOfHours) % 24;
                var Hours = Math.floor(Remainder);
                var Minutes = Math.floor(60 * (Remainder - Hours));
                return ({ "Days": Days, "Hours": Hours, "Minutes": Minutes })
            }; 
            docWrite("{{ row.ticket.time_elapsed }}")</script></td>
        <td>{% if row.ticket.status == 2 or row.ticket.status == 3 %}
            <div class="answeredBtn"><img src="../../static/helpdesk/images/check.svg" alt="answered" />
                <span class="answeredBtnText">پاسخ داده شده</apan>
                </div>
                {% endif %}{% if row.ticket.status == 4 or row.ticket.status == 5 %}
                <div class="closeBtn"><img src="../../static/helpdesk/images/x-circle.svg" alt="close" />
                    <span class="closeBtnText">بسته شده</apan>
                </div>
                {% endif %}
                {% if row.ticket.status == 1 %}
                <div class="openBtn"><img src="../../static/helpdesk/images/file-minus.svg" alt="open" />
                    <span class="openBtnText">در دست بررسی</apan>
                </div>
                {% endif %}</td>
        <td><a class="showBtn" href="/view/?ticket={{ row.ticket.id }}&email={{ row.ticket.submitter_email }}&key={{ row.ticket.secret_key }}"><img src="../../static/helpdesk/images/eye.svg" alt="show" /><span class="showText">مشاهده
            </apan></a></td>
    </tr>
    {% endfor %}</table></div>
    </div>
    {% else %}
    <div class="homepage-container">
        <h1 class="head">تیکت ها</h1>
        <div class="card">
            <div class="cardEmpty">
                <img src="../../static/helpdesk/images/inbox.svg" alt="inbox" />
                <h3 class="subEmpty">تیکتی وجود ندارد</h3>
                <a class="btn" href="{% url 'helpdesk:submit' %}">
                    <img src="../../static/helpdesk/images/plus.svg" alt="inbox" /><span class="btnText">افزودن تیکت جدید
                        </apan>
                </a>
            </div>
        </div>
    </div>
    {% endif %}
<script >

</script>
{% endblock %}
